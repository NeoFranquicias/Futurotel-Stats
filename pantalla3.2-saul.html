<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Futurotel Stats - Gráfica Ocupación</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
  </head>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Orbitron", Arial, sans-serif;
      background: #12232e;
      color: #e0f7fa;
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      min-width: 100vw;
      overflow: hidden;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }
    main {
      width: 1200px;
      height: 520px;
      min-height: 520px;
      min-width: 1200px;
      padding: 0;
      margin: 0;
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      box-sizing: border-box;
      overflow: hidden;
      position: relative;
    }
    .dashboard-section {
      width: 1200px;
      height: 520px;
      min-height: 520px;
      min-width: 1200px;
      background: transparent;
      border-radius: 0;
      padding: 0;
      box-shadow: none;
      border: none;
      animation: fadein 1.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      box-sizing: border-box;
      margin: 0;
      position: relative;
      overflow: hidden;
    }
    .dashboard-section h2 {
      color: #00eaff;
      font-size: 2rem;
      margin: 0;
      padding: 1vh 0;
      letter-spacing: 0.08em;
      text-shadow: 0 0 10px #00eaff88;
      position: relative;
      z-index: 10;
      background: transparent;
      width: 100%;
      text-align: center;
      animation: subtleGlow 3s infinite;
    }
    .graph-container {
      width: 100%;
      height: calc(100% - 60px);
      margin: 0;
      box-sizing: border-box;
      padding: 20px;
      align-items: center;
      position: relative;
      z-index: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .chart-wrapper {
      width: 95%;
      height: 360px;
      background: rgba(18, 35, 46, 0.3);
      border: 1px solid rgba(0, 234, 255, 0.3);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0, 234, 255, 0.1),
        inset 0 0 15px rgba(0, 234, 255, 0.05);
      padding: 20px;
      position: relative;
      margin-top: 10px;
    }
    .chart-wrapper::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(0, 234, 255, 0.5),
        transparent
      );
    }
    .event-legend {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      padding: 5px;
      background: rgba(18, 35, 46, 0.7);
      border-radius: 10px;
      max-width: 95%;
      margin-left: auto;
      margin-right: auto;
      width: 95%;
      height: auto;
    }
    .event-item {
      display: flex;
      align-items: center;
      margin: 2px 2px;
      font-size: 0.75rem;
      min-width: 160px;
      padding: 3px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .event-item span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .event-item:hover {
      background: rgba(0, 0, 0, 0.4);
      transform: translateY(-2px);
    }
    .event-color {
      min-width: 12px;
      min-height: 12px;
      margin-right: 6px;
      border-radius: 3px;
      box-shadow: 0 0 5px rgba(0, 234, 255, 0.3);
      flex-shrink: 0;
    }
    @keyframes fadein {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes subtleGlow {
      0%,
      100% {
        text-shadow: 0 0 14px #00eaff88;
      }
      50% {
        text-shadow: 0 0 18px #00eaff;
      }
    }
  </style>
  <body>
    <header class="futuristic-header" hidden>
      <div class="logo-glow">Futurotel <span>Stats</span></div>
    </header>
    <main
      id="main-dashboard"
      style="
        width: 1200px;
        height: 520px;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        box-sizing: border-box;
        overflow: hidden;
      "
    >
      <section
        class="dashboard-section"
        style="
          width: 1200px;
          height: 520px;
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        "
      >
        <h2 style="margin: 0; padding: 1vh 0; width: 100%; text-align: center">
          Gráfica Ocupación
        </h2>
        <div class="graph-container">
          <div class="event-legend" id="eventLegend"></div>
          <div class="chart-wrapper">
            <canvas id="ocupacionChart"></canvas>
          </div>
        </div>
      </section>
    </main>
    <footer class="futuristic-footer" hidden>
      <span>&copy; 2025 Futurotel Insights. All rights reserved.</span>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Datos de ocupación diaria (30 días)
        const diasMes = Array.from({ length: 30 }, (_, i) => i + 1);

        // Cargar datos desde el archivo JSON
        fetch("eventos.json")
          .then((response) => response.json())
          .then((data) => {
            // Valores base de ocupación (porcentajes)
            const ocupacionBase = data.ocupacion;

            // Configuración de eventos
            const eventos = data.eventos;

            // Mejora para resaltar días con mayor ocupación
            const daysWithHighOccupancy = [];
            for (let i = 0; i < diasMes.length; i++) {
              const dia = diasMes[i];
              let hasEvent = false;

              eventos.forEach((evento) => {
                if (dia >= evento.fechaInicio && dia <= evento.fechaFin) {
                  hasEvent = true;
                }
              });

              daysWithHighOccupancy.push(hasEvent);
            }

            // Crear anotaciones para los eventos ajustadas para llegar hasta los círculos
            const annotations = {};

            eventos.forEach((evento, index) => {
              annotations[`box${index}`] = {
                type: "box",
                xMin: evento.fechaInicio - 0.5,
                xMax: evento.fechaFin + 0.5,
                yMin: 0,
                yMax: 100,
                backgroundColor: evento.color,
                borderColor: evento.borderColor,
                borderWidth: 0,
                borderRadius: 0,
                // Make overlapping events visible with a little transparency
                borderDash: index > 4 ? [5, 5] : [],
                drawTime: "beforeDatasetsDraw",
              };
            });

            // Crear leyenda de eventos personalizada
            const legendContainer = document.getElementById("eventLegend");
            legendContainer.innerHTML =
              "<div style='width:100%; text-align:center; margin-bottom:6px; color:#00eaff; font-weight:bold; font-size:0.9rem;'>Eventos de Mayo</div>";

            // Crear grid de 3 columnas para mejor visualización
            const grid = document.createElement("div");
            grid.style.display = "grid";
            grid.style.gridTemplateColumns =
              "repeat(auto-fill, minmax(250px, 1fr))";
            grid.style.width = "100%";
            grid.style.gap = "3px";

            eventos.forEach((evento) => {
              const item = document.createElement("div");
              item.className = "event-item";
              item.title = `${evento.nombre} (${evento.fechaInicio}-${evento.fechaFin})`;

              const colorBox = document.createElement("div");
              colorBox.className = "event-color";
              colorBox.style.backgroundColor = evento.borderColor;

              const label = document.createElement("span");
              label.textContent = `${evento.nombre} (${evento.fechaInicio}-${evento.fechaFin})`;

              item.appendChild(colorBox);
              item.appendChild(label);
              grid.appendChild(item);
            });

            legendContainer.appendChild(grid);

            // Configurar y crear el gráfico
            const ctx = document
              .getElementById("ocupacionChart")
              .getContext("2d");
            const chart = new Chart(ctx, {
              type: "line",
              data: {
                labels: diasMes,
                datasets: [
                  {
                    label: "Ocupación (%)",
                    data: ocupacionBase,
                    borderColor: "#00eaff",
                    backgroundColor: "rgba(0, 234, 255, 0.1)",
                    borderWidth: 3,
                    pointRadius: (context) => {
                      // Points for days with events are slightly bigger
                      const index = context.dataIndex;
                      return daysWithHighOccupancy[index] ? 6 : 5;
                    },
                    pointBackgroundColor: (context) => {
                      const index = context.dataIndex;
                      return daysWithHighOccupancy[index] ? "#ffcc00" : "#fff";
                    },
                    pointBorderColor: "#00eaff",
                    pointHoverRadius: 8,
                    pointBorderWidth: 2,
                    fill: true,
                    tension: 0.3,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                  point: {
                    hitRadius: 10,
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    max: 100,
                    grid: {
                      color: "rgba(255, 255, 255, 0.1)",
                    },
                    ticks: {
                      color: "#e0f7fa",
                      font: {
                        family: "Orbitron",
                      },
                      callback: function (value) {
                        return value + "%";
                      },
                    },
                  },
                  x: {
                    grid: {
                      color: "rgba(255, 255, 255, 0.1)",
                      offset: true,
                    },
                    ticks: {
                      color: "#e0f7fa",
                      font: {
                        family: "Orbitron",
                        size: 10,
                      },
                      padding: 0,
                      align: "center",
                      autoSkip: false,
                      maxRotation: 0,
                      minRotation: 0,
                    },
                    offset: true,
                    type: "linear",
                    min: 1,
                    max: 30,
                    afterFit: function (scaleInstance) {
                      scaleInstance.width = scaleInstance.width;
                    },
                  },
                },
                plugins: {
                  legend: {
                    display: false,
                  },
                  tooltip: {
                    backgroundColor: "rgba(18, 35, 46, 0.8)",
                    titleFont: {
                      family: "Orbitron",
                      size: 14,
                    },
                    bodyFont: {
                      family: "Orbitron",
                      size: 13,
                    },
                    callbacks: {
                      title: function (tooltipItems) {
                        return "Día " + tooltipItems[0].label + " de Mayo";
                      },
                      label: function (context) {
                        return "Ocupación: " + context.parsed.y + "%";
                      },
                      afterLabel: function (context) {
                        // Mostrar evento si hay alguno ese día
                        const dia = parseInt(context.label);
                        let eventosDelDia = [];

                        eventos.forEach((evento) => {
                          if (
                            dia >= evento.fechaInicio &&
                            dia <= evento.fechaFin
                          ) {
                            eventosDelDia.push(evento.nombre);
                          }
                        });

                        if (eventosDelDia.length > 0) {
                          if (eventosDelDia.length === 1) {
                            return "Evento: " + eventosDelDia[0];
                          } else {
                            let result = "Eventos:";
                            eventosDelDia.forEach((evento, index) => {
                              result += "\n- " + evento;
                            });
                            return result;
                          }
                        }
                        return "";
                      },
                    },
                  },
                  annotation: {
                    annotations: annotations,
                  },
                },
              },
            });
          })
          .catch((error) =>
            console.error("Error al cargar el archivo JSON:", error)
          );
      });

      function scaleDashboard() {
        const main = document.getElementById("main-dashboard");
        if (!main) return;

        const baseWidth = 1200;
        const baseHeight = 520;
        const targetWidth = 1200;
        const targetHeight = 520;

        // Calcular el factor de escala
        const scaleW = targetWidth / baseWidth;
        const scaleH = targetHeight / baseHeight;
        const scale = Math.min(scaleW, scaleH);

        // Aplicar la transformación con un límite mínimo de escala
        const minScale = 0.7; // 70% de zoom mínimo
        const finalScale = Math.max(scale, minScale);

        main.style.transform = `scale(${finalScale})`;
        main.style.transformOrigin = "top left";

        // Ajustar el contenedor para mantener las proporciones
        const container = main.parentElement;
        container.style.width = `${targetWidth}px`;
        container.style.height = `${targetHeight}px`;
        container.style.overflow = "hidden";
        container.style.position = "relative";
      }

      // Aplicar el escalado al cargar y al redimensionar
      window.addEventListener("load", scaleDashboard);
      window.addEventListener("resize", scaleDashboard);

      // Aplicar el escalado inicial
      document.addEventListener("DOMContentLoaded", scaleDashboard);
    </script>

    <script src="particles-bg.js"></script>
  </body>
</html>
