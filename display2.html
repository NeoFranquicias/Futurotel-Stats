<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Display Futurotel</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        background: #0a0e17;
        font-family: "Orbitron", Arial, sans-serif;
      }

      .display-container {
        width: 100vw;
        height: 100vh;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 8px;
        padding: 8px;
        box-sizing: border-box;
      }

      .display-frame {
        background: rgba(10, 14, 23, 0.3);
        border: 1px solid rgba(0, 234, 255, 0.1);
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
      }

      .display-frame iframe {
        flex: 1;
        width: 100%;
        height: 100%;
        border: none;
        background: transparent;
        transform-origin: 0 0;
        transform: none;
        min-width: 0;
        min-height: 0;
        transition: opacity 0.5s ease-in-out;
      }

      .frame-title {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        padding: 4px;
        background: rgba(10, 14, 23, 0.8);
        color: #00eaff;
        font-size: 0.8rem;
        text-align: center;
        z-index: 1;
        border-bottom: 1px solid rgba(0, 234, 255, 0.1);
      }

      @keyframes gradientBorder {
        0% {
          border-color: rgba(0, 234, 255, 0.1);
        }
        50% {
          border-color: rgba(0, 234, 255, 0.3);
        }
        100% {
          border-color: rgba(0, 234, 255, 0.1);
        }
      }

      .display-frame {
        animation: gradientBorder 4s infinite;
      }

      /* Estilos específicos para cada iframe */
      .display-frame:nth-child(1) iframe {
        transform: scale(0.5);
      }

      .display-frame:nth-child(2) iframe {
        transform: scale(0.5);
      }

      .display-frame:nth-child(3) iframe {
        transform: scale(0.5);
      }

      .display-frame:nth-child(4) iframe {
        transform: scale(0.5);
      }

      /* Ajustes para mantener la proporción y visibilidad */
      .display-frame iframe {
        min-width: 200%;
        min-height: 200%;
        width: 200%;
        height: 200%;
      }

      /* Estilos para el overlay */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        z-index: 1000;
        cursor: default;
      }

      /* Clase para la animación de fade */
      .fade-out {
        opacity: 0;
      }

      /* Estilos para la animación de construcción */
      .content-reveal {
        opacity: 0;
        animation: revealAnimation 1.5s ease-out forwards;
      }

      @keyframes revealAnimation {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .typewriter {
        overflow: hidden;
        border-right: 3px solid #00eaff;
        white-space: nowrap;
        margin: 0 auto;
        letter-spacing: 0.15em;
        animation: typing 1s steps(40, end), blink-caret 0.75s step-end infinite;
      }

      @keyframes typing {
        from { width: 0 }
        to { width: 100% }
      }

      @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: #00eaff; }
      }
    </style>
  </head>
  <body>
    <!-- Overlay para prevenir clics -->
    <div class="overlay"></div>

    <div class="display-container">
      <div class="display-frame">
        <iframe src="pantalla1.html" scrolling="no"></iframe>
      </div>
      <div class="display-frame">
        <iframe src="pantalla2.html" scrolling="no"></iframe>
      </div>
      <div class="display-frame">
        <iframe src="pantalla3.html" scrolling="no"></iframe>
      </div>
      <div class="display-frame">
        <iframe src="acciones-recomendadas.html" scrolling="no"></iframe>
      </div>
    </div>
    <script src="particles-bg.js"></script>
    <script>
      // Ajustar el escalado de los iframes
      function adjustIframes() {
        const frames = document.querySelectorAll(".display-frame iframe");
        frames.forEach((frame) => {
          frame.style.transform = "scale(0.5)";
          frame.style.transformOrigin = "0 0";
        });
      }

      // Ajustar cuando se carga la página
      window.addEventListener("load", adjustIframes);

      // Ajustar cuando cambia el tamaño de la ventana
      window.addEventListener("resize", adjustIframes);

      // Función para animar el contenido de un iframe
      function animateIframeContent(iframe) {
        try {
          // Esperar un poco para asegurar que el contenido esté listo
          setTimeout(() => {
            try {
              const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
              if (!iframeDoc) return;
              
              // Función para animar elementos
              const animateElements = () => {
                // Aplicar animación de revelación a todos los elementos principales
                const elements = iframeDoc.querySelectorAll('h1, h2, h3, h4, p, div, section, article, .card, .panel, .acciones-card, .acciones-grid');
                
                elements.forEach((el, index) => {
                  // Saltar elementos que ya tienen animación o están ocultos
                  if (el.classList.contains('content-reveal') || 
                      el.offsetParent === null || 
                      el.offsetWidth === 0 || 
                      el.offsetHeight === 0) {
                    return;
                  }
                  
                  // Aplicar estilos iniciales
                  const originalTransition = el.style.transition;
                  el.style.opacity = '0';
                  el.style.transform = 'translateY(20px)';
                  el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                  
                  // Forzar repintado
                  void el.offsetHeight;
                  
                  // Aplicar animación con retraso escalonado
                  setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                    
                    // Para títulos, agregar efecto de máquina de escribir
                    if (el.tagName.match(/^H[1-3]$/i)) {
                      el.classList.add('typewriter');
                      // Eliminar la clase después de la animación
                      setTimeout(() => {
                        el.classList.remove('typewriter');
                        el.style.borderRight = 'none';
                      }, 1500);
                    }
                    
                    // Restaurar transición original después de la animación
                    setTimeout(() => {
                      el.style.transition = originalTransition;
                    }, 1000);
                  }, 50 + (index * 100)); // Retraso escalonado
                });
              };
              
              // Intentar animar inmediatamente
              animateElements();
              
              // Configurar un MutationObserver para animar contenido dinámico
              const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                  if (mutation.addedNodes.length > 0) {
                    // Pequeño retraso para asegurar que el contenido esté listo
                    setTimeout(animateElements, 100);
                  }
                });
              });
              
              // Observar cambios en el contenido del iframe
              observer.observe(iframeDoc.body, {
                childList: true,
                subtree: true,
                attributes: true,
                characterData: true
              });
              
              // Si el iframe tiene su propio sistema de carga
              if (iframe.contentWindow && iframe.contentWindow.addEventListener) {
                iframe.contentWindow.addEventListener('load', animateElements);
              }
              
            } catch (e) {
              console.log('Error al animar el contenido del iframe:', e);
            }
          }, 300); // Pequeño retraso para asegurar que el iframe esté listo
          
        } catch (e) {
          console.log('No se pudo acceder al iframe:', e);
        }
      }

      // Mapeo de teclas a URLs de transición
      const transitionMap = {
        1: {
          "pantalla1.html": "pantalla1.2.html",
          "pantalla1.2.html": "formula-precios-optimos.html",
          "formula-precios-optimos.html": "tablas.html",
          "tablas.html": "pantalla1.html",
        },
        2: {
          "pantalla2.html": "pantalla2.2.html",
          "pantalla2.2.html": "pantalla2.html",
        },
        3: {
          "pantalla3.html": "pantalla3.2.html",
          "pantalla3.2.html": "pantalla3.html",
        },
      };

      // Función para manejar la carga de un iframe
      function handleIframeLoad(frame) {
        if (!frame || !frame.contentWindow) return;
        
        // Función para verificar si el iframe está listo
        const checkIframeReady = () => {
          try {
            if (frame.contentDocument && frame.contentDocument.readyState === 'complete') {
              animateIframeContent(frame);
              return true;
            }
          } catch (e) {
            // Error de política de mismo origen
            console.log('No se puede acceder al iframe por políticas de seguridad:', e);
            return true; // No seguir intentando
          }
          return false;
        };
        
        // Intentar inmediatamente
        if (!checkIframeReady()) {
          // Si no está listo, configurar eventos de carga
          const onLoad = () => {
            frame.removeEventListener('load', onLoad);
            setTimeout(() => animateIframeContent(frame), 100);
          };
          
          frame.addEventListener('load', onLoad);
          
          // Timeout de respaldo en caso de que el evento load no se dispare
          setTimeout(() => {
            frame.removeEventListener('load', onLoad);
            checkIframeReady();
          }, 2000);
        }
      }

      // Configurar observador de mutación para detectar cambios en los iframes
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            mutation.addedNodes.forEach((node) => {
              if (node.tagName === 'IFRAME') {
                handleIframeLoad(node);
              } else if (node.querySelectorAll) {
                // Buscar iframes dentro del nodo agregado
                const iframes = node.querySelectorAll('iframe');
                iframes.forEach(iframe => handleIframeLoad(iframe));
              }
            });
          }
        });
      });

      // Observar cambios en el documento
      observer.observe(document.body, { 
        childList: true, 
        subtree: true 
      });
      
      // Manejar iframes que ya están en el DOM
      document.querySelectorAll('iframe').forEach(handleIframeLoad);

      // Manejar las transiciones con las teclas numéricas
      document.addEventListener("keydown", function (event) {
        const key = event.key;
        if (key >= "1" && key <= "3") {
          const frameIndex = parseInt(key) - 1;
          const frame = document.querySelectorAll(".display-frame iframe")[frameIndex];
          if (frame) {
            const currentSrc = frame.src.split("/").pop();
            const transitions = transitionMap[key];
            if (transitions && transitions[currentSrc]) {
              // Agregar clase para fade out
              frame.classList.add("fade-out");

              // Esperar a que termine la animación antes de cambiar la fuente
              setTimeout(() => {
                frame.src = transitions[currentSrc];
                
                // Configurar el manejador de carga para el nuevo contenido
                frame.onload = function() {
                  // Pequeño retraso para asegurar que el contenido esté listo
                  setTimeout(() => {
                    frame.classList.remove("fade-out");
                    handleIframeLoad(frame);
                  }, 100);
                };
              }, 500);
            }
          }
        } else if (key === "4") {
          // Para la tecla 4, enviar el evento al iframe de acciones-recomendadas
          const frame = document.querySelectorAll(".display-frame iframe")[3];
          if (frame && frame.contentWindow) {
            frame.contentWindow.postMessage("navegarSiguiente", "*");
          }
        }
      });

      // Animar los iframes iniciales
      document.addEventListener('DOMContentLoaded', () => {
        const frames = document.querySelectorAll('.display-frame iframe');
        frames.forEach(frame => {
          handleIframeLoad(frame);
        });
      });
    </script>
    <div
      id="android-version-indicator"
      style="
        position: fixed;
        right: 10px;
        bottom: 8px;
        font-size: 1.5rem;
        color: #00eaff99;
        z-index: 9999;
        pointer-events: none;
        font-family: monospace;
        opacity: 0.7;
      "
    ></div>
    <div
      id="os-indicator"
      style="
        position: fixed;
        left: 10px;
        bottom: 8px;
        font-size: 1.5rem;
        color: #00eaff99;
        z-index: 9999;
        pointer-events: none;
        font-family: monospace;
        opacity: 0.7;
      "
    ></div>
    <!--
    <script>
      function getOSNameAndVersion() {
        var ua = navigator.userAgent;
        // Windows
        var winMatch = ua.match(/Windows NT ([0-9.]+)/i);
        if (winMatch) {
          var map = {
            "10.0": "Windows 10",
            "11.0": "Windows 11",
            6.3: "Windows 8.1",
            6.2: "Windows 8",
            6.1: "Windows 7",
            "6.0": "Windows Vista",
            5.1: "Windows XP",
          };
          var ver = winMatch[1];
          return map[ver] ? map[ver] : "Windows " + ver;
        }
        // macOS
        var macMatch = ua.match(/Mac OS X ([0-9_]+)/i);
        if (macMatch) {
          var ver = macMatch[1].replace(/_/g, ".");
          return "macOS " + ver;
        }
        // Android
        var androidMatch = ua.match(/Android ([0-9.]+)/i);
        if (androidMatch) {
          return "Android " + androidMatch[1];
        }
        // iOS
        var iosMatch = ua.match(/(iPhone|iPad|iPod).*OS ([0-9_]+)/i);
        if (iosMatch) {
          var ver = iosMatch[2].replace(/_/g, ".");
          return "iOS " + ver;
        }
        // Linux
        if (/linux/i.test(ua)) return "Linux";
        return "Otro SO";
      }
      document.getElementById("os-indicator").textContent =
        getOSNameAndVersion();
    </script>
    <script>
      function getAndroidVersion() {
        var ua = navigator.userAgent || navigator.vendor || window.opera;
        var match = ua.match(/Android\s([0-9\.]+)/i);
        return match ? match[1] : null;
      }
      var el = document.getElementById("android-version-indicator");
      var version = getAndroidVersion();
      function getBrowserName() {
        var ua = navigator.userAgent;
        if (ua.match(/edg/i)) return "Edge";
        if (ua.match(/chrome|crios/i) && !ua.match(/edg/i)) return "Chrome";
        if (ua.match(/firefox|fxios/i)) return "Firefox";
        if (ua.match(/safari/i) && !ua.match(/chrome|crios|edg/i))
          return "Safari";
        if (ua.match(/opera|opr/i)) return "Opera";
        return "Otro";
      }
      var browser = getBrowserName();
      function getChromeVersion() {
        var ua = navigator.userAgent;
        var match = ua.match(/Chrome\/([0-9.]+)/i);
        return match ? match[1] : null;
      }
      var chromeVersion = browser === "Chrome" ? getChromeVersion() : null;
      if (version && browser === "Chrome" && chromeVersion) {
        el.textContent = "Android: " + version + " | Chrome " + chromeVersion;
      } else if (browser === "Chrome" && chromeVersion) {
        el.textContent = "Chrome " + chromeVersion;
      } else if (version) {
        el.textContent = "Android: " + version + " | " + browser;
      } else {
        el.textContent = browser;
      }
    </script> -->
  </body>
</html>
