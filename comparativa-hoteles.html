<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparativa de Hoteles</title>
    <link href="https://fonts.googleapis.com/css?family=Orbitron:400,700&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden;
            background: #12232e;
        }
        body {
            min-height: 100vh;
            min-width: 100vw;
            position: relative;
            font-family: 'Orbitron', Arial, sans-serif;
        }
        .chart-container {
            position: absolute;
            top: 0; left: 0; width: 100vw; height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        #compare-chart {
            display: block;
            background: transparent !important;
        }
        .compare-title {
            position: absolute;
            top: 0vh;
            left: 0; right: 0;
            text-align: center;
            color: #fff;
            font-family: 'Orbitron', Arial, sans-serif;
            font-size: 2.5rem;
            letter-spacing: 0.08em;
            text-shadow: 0 0 18px #00eaff, 0 0 32px #0ff4f8;
            z-index: 2;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <h2 class="compare-title">Comparativa de Hoteles</h2>
    <div class="chart-container">
        <canvas id="compare-chart"></canvas>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    // Ajusta el canvas de la gráfica para que siempre sea cuadrado y ocupe el máximo posible
    function resizeRadarCanvas() {
        const c = document.getElementById('compare-chart');
        const size = Math.min(window.innerWidth, window.innerHeight);
        c.width = size;
        c.height = size;
        c.style.width = size + 'px';
        c.style.height = size + 'px';
    }
    window.addEventListener('resize', resizeRadarCanvas);
    resizeRadarCanvas();
    </script>
    <script>
    // --- GRAFICA RADAR ---
    let hoteles = [];
    let kpiData = [];
    fetch('hoteles.json')
        .then(resp => resp.json())
        .then(data => {
            hoteles = data;
            kpiData = hoteles.map(hotel => {
                let baseOcup = Math.random()*20+65;
                let ocupacion = Array.from({length:30}, (_,i)=>Math.round(baseOcup+Math.sin(i/5)*3+Math.random()*2));
                let reservas = Array.from({length:30}, (_,i)=>Math.round(ocupacion[i]*2+Math.random()*10));
                let cancel = Array.from({length:30}, (_,i)=>Math.round(reservas[i]*Math.random()*0.09));
                let adr = Array.from({length:30}, (_,i)=>Math.round(Math.random()*30+90));
                let revpar = ocupacion.map((o,i)=>Math.round(adr[i]*o/100));
                let ingresos = reservas.map((r,i)=>Math.round(r*adr[i]));
                let satisfaccion = Math.round(Math.random()*10+85);
                return { ...hotel, ocupacion, reservas, cancel, adr, revpar, ingresos, satisfaccion };
            });
            window.kpiData = kpiData;
            renderCompareChart(kpiData, kpiData.map(h=>h.nombre));
        });
    // Paleta colores
    const colorPalette = [
        '#0074D9','#FF4136','#2ECC40','#FF851B','#B10DC9','#FFDC00','#001f3f','#39CCCC','#01FF70','#F012BE','#3D9970','#85144b','#7FDBFF','#870C25','#AAAAAA','#111111','#F39C12','#8E44AD','#E67E22','#16A085'
    ];
    let compareChart = null;
    function renderCompareChart(kpiData, nombres) {
        const canvas = document.getElementById('compare-chart');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const dataSel = kpiData.filter(h => nombres.includes(h.nombre));
        if (compareChart) compareChart.destroy();
        const labels = ['Ocupación (%)','Ingresos (€)','ADR (€)','RevPAR (€)','Satisfacción'];
        let maxOcup = Math.max(...kpiData.map(h=>Math.round(h.ocupacion.reduce((a,b)=>a+b,0)/h.ocupacion.length)), 100);
        let maxIng = Math.max(...kpiData.map(h=>h.ingresos.reduce((a,b)=>a+b,0)), 1);
        let maxAdr = Math.max(...kpiData.map(h=>Math.round(h.adr.reduce((a,b)=>a+b,0)/h.adr.length)), 1);
        let maxRevpar = Math.max(...kpiData.map(h=>Math.round(h.revpar.reduce((a,b)=>a+b,0)/h.revpar.length)), 1);
        let maxSat = 100;
        const datasets = dataSel.map((h,i) => {
            let ocup = Math.round(h.ocupacion.reduce((a,b)=>a+b,0)/h.ocupacion.length) || 0;
            let ing = h.ingresos.reduce((a,b)=>a+b,0) || 0;
            let adr = Math.round(h.adr.reduce((a,b)=>a+b,0)/h.adr.length) || 0;
            let revpar = Math.round(h.revpar.reduce((a,b)=>a+b,0)/h.revpar.length) || 0;
            let sat = h.satisfaccion || 0;
            let ocupN = Math.round(ocup/maxOcup*100);
            let ingN = Math.round(ing/maxIng*100);
            let adrN = Math.round(adr/maxAdr*100);
            let revparN = Math.round(revpar/maxRevpar*100);
            let satN = Math.round(sat/maxSat*100);
            const color = colorPalette[i % colorPalette.length];
            return {
                label: h.nombre,
                data: [ocupN, ingN, adrN, revparN, satN],
                fill: true,
                backgroundColor: color + '44',
                borderColor: color,
                borderWidth: 2.5,
                pointBackgroundColor: '#fff',
                pointRadius: 5,
                tension: 0,
                realValues: [ocup, ing, adr, revpar, sat]
            }
        });
        compareChart = new Chart(ctx, {
            type: 'radar',
            data: { labels, datasets },
            options: {
                responsive: false,
                maintainAspectRatio: false,
                layout: { padding: 60 },
                plugins: {
                    legend: {
  position: 'bottom',
  labels: {
    color: '#00eaff',
    font: { family: 'Orbitron', size: 18 },
    boxWidth: 18,
    padding: 12
  }
},
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const i = context.dataIndex;
                                const real = context.dataset.realValues && context.dataset.realValues[i];
                                let label = context.dataset.label || '';
                                let metric = context.chart.data.labels[i];
                                let value = typeof real !== 'undefined' ? real : context.parsed.r;
                                if(metric.includes('Ingresos')) {
                                    value = value.toLocaleString('es-ES') + ' €';
                                } else if(metric.includes('ADR')||metric.includes('RevPAR')) {
                                    value = value + ' €';
                                } else if(metric.includes('Ocupación')) {
                                    value = value + '%';
                                } else if(metric.includes('Satisfacción')) {
                                    value = value + ' / 100';
                                }
                                return `${label}: ${value}`;
                            }
                        }
                    }
                },
                scales: {
                    r: {
                        angleLines: { color: '#00eaff33' },
                        grid: { color: '#00eaff22' },
                        pointLabels: { color: '#fff', font: { family: 'Orbitron', size: 19 } },
                        ticks: { color: '#00eaff', backdropColor: 'transparent', font: { size: 15 } }
                    }
                },
                animation: {
                    duration: 1300,
                    easing: 'easeInOutQuart',
                    animateRotate: true,
                    animateScale: true,
                    onProgress: function(animation) {
                        //if (animation.currentStep === 1 && ctx) ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
                    }
                }
            }
        });

        // --- Animación eléctrica/futurista mejorada ---
if(window.radarElectricInterval) clearInterval(window.radarElectricInterval);
window.radarElectricInterval = setInterval(() => {
    if (compareChart && compareChart.data && compareChart.data.datasets) {
        compareChart.data.datasets.forEach(ds => {
            // Número de puntos a mover por dataset en cada ciclo (1 o 2)
            let puntosAMover = Math.random() < 0.7 ? 1 : 2;
            let indices = [];
            while (indices.length < puntosAMover) {
                let idx = Math.floor(Math.random() * ds.data.length);
                if (!indices.includes(idx)) indices.push(idx);
            }
            ds.data = ds.data.map((v, i) => {
                if (indices.includes(i)) {
                    let delta = (Math.random() - 0.5) * 3; // movimiento pequeño
                    let nuevo = v + delta;
                    if (nuevo > 100) nuevo = 100;
                    if (nuevo < 0) nuevo = 0;
                    return Math.round((v + (nuevo - v) * 0.35)*100)/100;
                } else {
                    return v;
                }
            });
        });
        compareChart.update('active');
    }
}, 5000);
    }

    // Redibuja la gráfica tras cada resize
    function resizeRadarCanvas() {
        const c = document.getElementById('compare-chart');
        const container = document.querySelector('.chart-container');
        const size = Math.min(window.innerWidth, window.innerHeight);
        container.style.width = window.innerWidth + 'px';
        container.style.height = window.innerHeight + 'px';
        c.width = size;
        c.height = size;
        c.style.width = size + 'px';
        c.style.height = size + 'px';
        if (window.kpiData && window.kpiData.length > 0) {
            renderCompareChart(window.kpiData, window.kpiData.map(h=>h.nombre));
        }
    }
    window.addEventListener('resize', resizeRadarCanvas);
    
    </script>
    <script src="particles-bg.js"></script>
</body>
</html>
