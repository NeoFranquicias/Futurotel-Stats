<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Acciones Recomendadas - Futurotel</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #12232e;
        font-family: "Orbitron", Arial, sans-serif;
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }
      .acciones-zoom-wrapper {
        width: 100vw;
        height: 100vh;
        display: flex;
        /* align-items: center; */
        justify-content: center;
        overflow: hidden;
      }
      .acciones-panel {
        width: 98vw;
        max-width: 1400px;
        background: none;
        border-radius: 10px;
        box-shadow: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        position: relative;
        z-index: 1;
        padding: 0;
        margin: 30px;
      }
      .acciones-title {
        color: #00eaff;
        font-size: clamp(1.3rem, 2vw, 2rem);
        margin-bottom: 20px;
        text-align: center;
        letter-spacing: 0.1em;
        text-shadow: 0 0 10px #00eaff88;
      }
      .acciones-grid {
        display: grid;
        grid-template-columns: 1fr 1.3fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 10px 14px;
        width: 100%;
        height: 70vh;
        min-height: 400px;
        margin: 0;
        padding: 0 10px;
        box-sizing: border-box;
      }
      .acciones-card {
        opacity: 0;
        transform: translateY(30px) scale(0.98);
        animation: cardFadeIn 0.7s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        background: rgba(18, 35, 46, 0.3);
        border: 1px solid rgba(0, 234, 255, 0.3);
        border-radius: 20px;
        box-shadow: 0 0 30px rgba(0, 234, 255, 0.1),
          inset 0 0 15px rgba(0, 234, 255, 0.05);
        padding: 8px 8px 7px 8px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        font-size: 1.2rem;
        color: #e0f7fa;
        position: relative;
        min-width: 0;
        min-height: 0;
        z-index: 2;
        transition: border-color 0.3s;
        height: 100%;
        box-sizing: border-box;
        overflow: hidden;
      }
      .acciones-card.cian {
        border-color: #00eaff;
        box-shadow: 0 0 24px #00eaff55;
        font-size: 1.7rem;
        padding: 24px 18px 20px 18px;
      }
      .acciones-card.cian .acciones-label {
        font-size: 2.1rem;
        margin-bottom: 10px;
      }
      .acciones-card.cian .acciones-fecha {
        font-size: 1.5rem;
        margin-bottom: 8px;
      }
      .acciones-card.cian .acciones-precio {
        font-size: 2.1rem;
        margin-bottom: 10px;
      }
      .acciones-card.cian .acciones-precio span {
        font-size: 1.5rem;
      }
      .acciones-card.verde {
        border-color: #00ffae;
        box-shadow: 0 0 18px #00ffae55;
        color: #00ffae;
      }
      .acciones-card.rojo {
        border-color: #ff2d55;
        box-shadow: 0 0 18px #ff2d5555;
        color: #ff2d55;
      }
      .acciones-card.justificacion {
        grid-column: 2 / span 1;
        grid-row: 1 / span 2;
        border-color: #00eaff;
        box-shadow: 0 0 14px #00eaff55;
        color: #e0f7fa;
        align-items: flex-start;
        font-size: 1.2rem;
        min-width: 0;
        min-height: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      .acciones-card .acciones-label {
        color: #00eaff;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 2px;
        letter-spacing: 0.06em;
        text-shadow: 0 0 4px #00eaff77;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .acciones-card .acciones-fecha {
        font-size: 1.05rem;
        color: #fff;
        margin-bottom: 1px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .acciones-card .acciones-precio {
        font-size: 1.5rem;
        color: #00eaff;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .acciones-card .acciones-precio span {
        color: #fff;
        font-size: 1.2rem;
        font-weight: normal;
      }
      .acciones-card .acciones-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1px;
        margin-bottom: 1px;
      }
      .acciones-card .acciones-table td,
      .acciones-card .acciones-table th {
        border: 1px solid #00eaff55;
        padding: 1px 4px;
        text-align: left;
        font-size: 1rem;
        color: #e0f7fa;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .acciones-card .acciones-table th {
        color: #00eaff;
        font-weight: 700;
        background: rgba(0, 234, 255, 0.09);
        text-shadow: 0 0 2px #00eaff55;
      }

      .acciones-card .acciones-reflexion {
        margin-top: 8px;
        color: #fff;
        font-size: 1.2rem;
        background: rgba(0, 234, 255, 0.06);
        border-left: 2px solid #00eaff99;
        padding: 8px 12px 8px 16px;
        border-radius: 6px;
        margin-bottom: 0;
        box-shadow: 0 0 6px #00eaff33;
        white-space: normal;
        line-height: 1.25;
      }
      .reflexion-item {
        margin-bottom: 12px;
        text-align: left;
      }
      .reflexion-label {
        font-size: 1.05rem;
        color: #00eaff;
        font-weight: bold;
        margin-bottom: 1px;
        letter-spacing: 0.04em;
        text-shadow: 0 0 4px #00eaff77;
      }
      .reflexion-value {
        font-size: 1.3rem;
        color: #fff;
        font-weight: bold;
        margin-bottom: 0;
        text-shadow: 0 0 3px #00eaff33;
      }
      .acciones-arrow {
        position: absolute;
        left: 50%;
        top: 55%;
        transform: translate(-50%, -50%);
        font-size: 1.6rem;
        color: #00eaff99;
        z-index: 3;
        pointer-events: none;
        text-shadow: 0 0 10px #00eaff88;
      }
      .acciones-card .acciones-derivacion {
        margin-top: 2px;
        font-size: 1.45rem;
        color: #fff;
        white-space: normal;
        line-height: 1.18;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .acciones-card.verde .acciones-label,
      .acciones-card.verde {
        color: #00ffae;
        border-color: #00ffae;
        background: rgba(18, 35, 46, 0.3);
        box-shadow: 0 0 30px rgba(0, 255, 174, 0.12),
          inset 0 0 15px rgba(0, 255, 174, 0.07);
      }
      .acciones-card.rojo .acciones-label,
      .acciones-card.rojo {
        color: #ff2d55;
        border-color: #ff2d55;
        background: rgba(18, 35, 46, 0.3);
        box-shadow: 0 0 30px rgba(255, 45, 85, 0.14),
          inset 0 0 15px rgba(255, 45, 85, 0.09);
      }

      @keyframes cardFadeIn {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      @keyframes cardFadeOut {
        from {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
        to {
          opacity: 0;
          transform: translateY(-30px) scale(0.98);
        }
      }

      @keyframes titleGlow {
        0% {
          text-shadow: 0 0 8px #00eaff88, 0 0 0 #00eaff00;
        }
        100% {
          text-shadow: 0 0 18px #00eaffcc, 0 0 8px #00eaff55;
        }
      }

      .acciones-card.justificacion ul,
      .acciones-card.justificacion ul li {
        font-size: 1.35rem;
        line-height: 1.5;
      }
    </style>
  </head>
  <body>
    <div class="acciones-zoom-wrapper">
      <div class="acciones-panel">
        <div class="acciones-title" id="mainTitle">Acciones Recomendadas</div>
        <br />
        <div class="acciones-grid" id="accionesGrid">
          <!-- Las tarjetas se rellenan por JS -->
        </div>
      </div>
    </div>
    <script src="particles-bg.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Autoescalado tipo foto
      function scaleAccionesPanel() {
        const wrapper = document.querySelector(".acciones-zoom-wrapper");
        const panel = document.querySelector(".acciones-panel");
        if (!wrapper || !panel) return;
        const baseWidth = 1232;
        const baseHeight = 520;
        const scaleW = window.innerWidth / baseWidth;
        const scaleH = window.innerHeight / baseHeight;
        const scale = Math.min(scaleW, scaleH, 1.3);
        panel.style.zoom = scale;
      }
      window.addEventListener("resize", scaleAccionesPanel);
      window.addEventListener("DOMContentLoaded", scaleAccionesPanel);
      scaleAccionesPanel();
    </script>
    <script>
      // Variables globales para rotaci√≥n y fetch
      let acciones = [];
      let justificaciones = {};
      let currentPantalla = 0;
      let totalPantallas = 1;
      let rotarInterval = null;

      async function fetchAcciones() {
        try {
          const resp = await fetch(
            "acciones-recomendadas-data.json?_=" + Date.now()
          );
          acciones = await resp.json();
        } catch (e) {
          acciones = [];
        }
      }
      async function fetchJustificaciones() {
        try {
          const resp = await fetch(
            "acciones-justificaciones.json?_=" + Date.now()
          );
          justificaciones = await resp.json();
        } catch (e) {
          justificaciones = {};
        }
      }
      function formatEuros(val) {
        return (
          (Math.round(val * 100) / 100).toLocaleString("es-ES", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          }) + "‚Ç¨"
        );
      }
      // Variables para controlar las animaciones en curso
      let currentAnimationFrame = null;
      let currentTypeWriterTimeout = null;
      let currentTitleTypeWriter = null;

      // Funci√≥n para limpiar animaciones en curso
      function clearAllAnimations() {
        if (currentAnimationFrame) {
          cancelAnimationFrame(currentAnimationFrame);
          currentAnimationFrame = null;
        }
        if (currentTypeWriterTimeout) {
          clearTimeout(currentTypeWriterTimeout);
          currentTypeWriterTimeout = null;
        }
        if (currentTitleTypeWriter) {
          clearTimeout(currentTitleTypeWriter);
          currentTitleTypeWriter = null;
        }
      }

      function renderPantalla(pantallaIdx) {
        if (!acciones.length) return;
        
        // Limpiar animaciones en curso
        clearAllAnimations();
        
        const accion = acciones[0]; // Solo una acci√≥n
        const pantallas = accion.pantallas || [];
        const pantalla = pantallas[pantallaIdx % pantallas.length];
        const grid = document.getElementById("accionesGrid");
        const title = document.getElementById('mainTitle');
        
        // Resetear el t√≠tulo inmediatamente
        if (title) {
          title.style.opacity = '0';
          title.style.transform = 'translateY(-20px)';
          title.style.transition = 'none';
          title.style.borderRight = 'none';
        }
        
        // Limpiar el grid inmediatamente
        grid.style.opacity = '0';
        grid.style.transition = 'opacity 0.3s ease';
        
        // Esperar un frame para asegurar que los estilos se apliquen
        currentAnimationFrame = requestAnimationFrame(() => {
          // Limpiar el contenido del grid
          grid.innerHTML = '';
          
          // Renderizar el nuevo contenido
          renderPantallaContent();
          
          // Animar el t√≠tulo principal
          if (title) {
            const titleText = title.textContent;
            title.textContent = '';
            title.style.opacity = '0';
            title.style.transform = 'translateY(-20px)';
            title.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            title.style.overflow = 'hidden';
            title.style.display = 'inline-block';
            
            // Mostrar el t√≠tulo con animaci√≥n
            setTimeout(() => {
              title.style.opacity = '1';
              title.style.transform = 'translateY(0)';
              
              // Efecto de m√°quina de escribir para el t√≠tulo
              title.style.borderRight = '2px solid #00eaff';
              let i = 0;
              const typeWriter = () => {
                if (i < titleText.length) {
                  title.textContent += titleText.charAt(i);
                  i++;
                  currentTitleTypeWriter = setTimeout(typeWriter, 30);
                } else {
                  title.style.borderRight = 'none';
                }
              };
              typeWriter();
            }, 100);
          }
          
          // Mostrar el grid con animaci√≥n
          setTimeout(() => {
            grid.style.opacity = '1';
            
            // Animar los elementos del grid
            const elements = grid.querySelectorAll('.acciones-card');
            elements.forEach((el, index) => {
              el.style.opacity = '0';
              el.style.transform = 'translateY(20px)';
              el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
              
              currentTypeWriterTimeout = setTimeout(() => {
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
                
                // Aplicar efecto de m√°quina de escribir a los t√≠tulos
                const title = el.querySelector('h3');
                if (title) {
                  const text = title.textContent;
                  title.textContent = '';
                  title.style.overflow = 'hidden';
                  title.style.borderRight = '2px solid #00eaff';
                  let i = 0;
                  const typeWriter = () => {
                    if (i < text.length) {
                      title.textContent += text.charAt(i);
                      i++;
                      currentTypeWriterTimeout = setTimeout(typeWriter, 30);
                    } else {
                      title.style.borderRight = 'none';
                    }
                  };
                  typeWriter();
                }
              }, index * 150);
            });
          }, 100);
        });
        function renderPantallaContent() {
          let html = "";
          if (pantalla.tipo === "accion") {
            const just = justificaciones[pantalla.justificacion_id] || {
              titulo: "",
              texto: [],
              reflexion: [],
            };
            // Tarjeta Acci√≥n
            html += `
            <div class="acciones-card cian" style="grid-column:1;grid-row:1;justify-content:center;align-items:center;">
              <div class="acciones-label">Acci√≥n #${accion.id}</div>
              <div class="acciones-fecha">${pantalla.fecha}</div>
              <div class="acciones-precio">Precio<br><span>${formatEuros(
                pantalla.precio_inicial
              )} ‚Üí ${formatEuros(pantalla.precio_accion)}</span></div>
            </div>
          `;
            // Tarjeta Reflexi√≥n
            html += `
            <div class="acciones-card cian" style="grid-column:1;grid-row:2; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; padding: 24px 18px 24px 22px;">
              
                <div style="font-size:1.4rem; color:#00eaff; font-weight:bold; margin-bottom: 4px;">Facturaci√≥n Objetivo</div>
                <div style="font-size:1.7rem; color:#fff; font-weight:bold; margin-bottom: 12px;">${formatEuros(pantalla.facturacion_objetivo)}</div>
                <div style="font-size:1.4rem; color:#00eaff; font-weight:bold; margin-bottom: 4px;">Facturaci√≥n Conseguida</div>
                <div style="font-size:1.7rem; color:#fff; font-weight:bold; margin-bottom: 12px;">${formatEuros(pantalla.facturacion_conseguida)}</div>
                <div style="font-size:1.4rem; color:#00eaff; font-weight:bold; margin-bottom: 4px;">Habitaciones por Vender</div>
                <div style="font-size:1.7rem; color:#fff; font-weight:bold;">${pantalla.habitaciones_por_vender}</div>
              </div>
            </div>
          `;
            // Tarjeta Justificaci√≥n
            html += `
            <div class="acciones-card justificacion">
              <div class="acciones-label">${
                just.titulo || "Justificaci√≥n"
              }</div>
              <ul style="margin: 0 0 10px 18px; padding: 0; color: #e0f7fa;">
                ${(just.texto || []).map((t) => `<li>${t}</li>`).join("")}
              </ul>
              <div class="acciones-reflexion">
                ${(just.reflexion || []).map((t) => `<div>${t}</div>`).join("")}
              </div>
            </div>
          `;
            // Tarjeta Si aplica (verde)
            html += `
            <div class="acciones-card verde" style="grid-column:3;grid-row:1;">
              <div class="acciones-label">Si se aplica la acci√≥n</div>
              <div class="acciones-derivacion">${pantalla.si_aplica || ""}</div>
            </div>
          `;
            // Tarjeta No aplica (rojo)
            html += `
            <div class="acciones-card rojo" style="grid-column:3;grid-row:2;">
              <div class="acciones-label">Si no se aplica la acci√≥n</div>
              <div class="acciones-derivacion">${pantalla.no_aplica || ""}</div>
            </div>
          `;
          } else if (pantalla.tipo === "grafica") {
            // Grid de 3 columnas y 2 filas: gr√°fica en columna 1 (2 filas), texto en columnas 2-3 (2 filas)
            html += `
            <div class='acciones-card cian' style='grid-column:1;grid-row:1/span 2;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px 10px 10px 10px;box-sizing:border-box;min-width:260px;'>
              <div class='acciones-label' style='margin-bottom:12px; font-size:1.6rem;'>Ventas por empleado</div>
              <canvas id='graficaBarras' width='320' height='390' style='display:block;margin:auto;width:100%;max-width:340px;background:rgba(0,0,0,0.12);border-radius:14px;'></canvas>
            </div>
            <div style='grid-column:2/span 2;grid-row:1/span 2;display:grid;grid-template-rows:auto;gap:18px;align-items:flex-start;justify-content:flex-start;min-width:420px;'>
              ${(Array.isArray(pantalla.texto) ? pantalla.texto : [])
                .map(
                  (seccion) => `
                <div class='acciones-card cian' style='padding:20px 18px 10px 18px;box-sizing:border-box;'>
                  <div class='acciones-label' style='margin-bottom:10px; font-size:1.6rem;'>${seccion.titulo}</div>
                  <div style='font-size:1.3rem;line-height:1.7;width:100%;word-break:break-word;white-space:normal;overflow-y:auto;max-height:95%;'>${seccion.texto}</div>
                </div>
              `
                )
                .join("")}
            </div>
          `;
          } else if (pantalla.tipo === "info") {
            const bloques = pantalla.contenido || [];
            const titulos = [
              "Estrategia Actual",
              "Recomendaci√≥n Principal",
              "Opci√≥n 1",
              "Opci√≥n 2",
            ];

            const gridStyles = [
              // Estrategia de Precio: columna 1, filas 1-2
              "grid-column:1;grid-row:1/span 2;max-width:380px;",
              // Recomendaci√≥n Principal: columnas 2-3, fila 1
              "grid-column:2/span 2;grid-row:1;",
              // Opci√≥n 1: columna 2, fila 2 (columna central, m√°s ancha)
              "grid-column:2;grid-row:2;min-height:130px;display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;",
              // Opci√≥n 2: columna 3, fila 2 (columna derecha, m√°s estrecha)
              "grid-column:3;grid-row:2;min-height:130px;display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-start;",
            ];
            for (let i = 0; i < 4; i++) {
              if (bloques[i] && bloques[i].trim() !== "") {
                let contenido = bloques[i];
                let contenidoHtml = "";
                // Si es un objeto JSON, usar campos titulo/texto/icono
                let titulo = titulos[i];
                if (typeof contenido === "object" && contenido !== null) {
                  titulo = contenido.titulo || titulos[i];
                  contenido = contenido.texto || "";
                }
                // Si es tipo lista (t√≠tulo + opciones)
                if (
                  contenido.includes(":") &&
                  contenido.split(":").length > 1
                ) {
                  const [cabecera, ...resto] = contenido.split(":");
                  contenidoHtml += `<div style='margin-bottom:6px;'>${cabecera}:</div>`;
                  contenidoHtml += `<ul style='margin-top:0;margin-bottom:0;padding-left:18px;'>`;
                  resto
                    .join(":")
                    .split(/\.|\n|‚Ä¢/)
                    .map((t) => t.trim())
                    .filter((t) => t.length > 0)
                    .forEach((t) => {
                      contenidoHtml += `<li>${t}</li>`;
                    });
                  contenidoHtml += `</ul>`;
                } else {
                  // Separar por punto y seguido en varios <p>
                  contenidoHtml = contenido
                    .split(/\.( |$)/)
                    .map((p) => p.trim())
                    .filter((p) => p.length > 0)
                    .map((p) => `<p style='margin:0 0 10px 0;'>${p}.</p>`)
                    .join("");
                }
                html +=
                  `<div class='acciones-card cian' style='${gridStyles[i]}padding: 18px 20px 10px 20px; display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;'>` +
                  `<div class='acciones-label' style='margin-bottom:12px;font-size:1.6rem;'>${titulo}</div>` +
                  `<div style='font-size:1.25rem;line-height:1.7;width:100%;word-break:break-word;white-space:normal;overflow-y:auto;max-height:95%;'>${contenidoHtml}</div>` +
                  `</div>`;
              }
            }
          }
          grid.innerHTML = html;
          grid.style.opacity = 1;
          // Renderizar gr√°fica si aplica
          if (pantalla.tipo === "grafica") {
            setTimeout(() => {
              try {
                if (window.Chart) {
                  const ctx = document
                    .getElementById("graficaBarras")
                    .getContext("2d");
                  // Destruye la gr√°fica anterior si existe
                  if (window.chartBarras) {
                    window.chartBarras.destroy();
                    window.chartBarras = null;
                  }
                  window.chartBarras = new Chart(ctx, {
                    type: "bar",
                    data: {
                      labels: pantalla.nombres,
                      datasets: [
                        {
                          label: "Ventas parking",
                          data: pantalla.valores,
                          backgroundColor: pantalla.valores.map((v) =>
                            v > 50 ? "#00eaff" : "#0cf"
                          ),
                          borderRadius: 8,
                          barThickness: 20,
                        },
                      ],
                    },
                    options: {
                      indexAxis: "y", // Barras horizontales
                      responsive: false,
                      plugins: { legend: { display: false } },
                      layout: {
                        padding: { left: 10, right: 10, top: 10, bottom: 10 },
                      },
                      scales: {
                        x: {
                          beginAtZero: true,
                          max: 100,
                          grid: { color: "#00eaff22" },
                          ticks: { color: "#e0f7fa", font: { size: 14 } },
                        },
                        y: {
                          grid: { color: "#00eaff22" },
                          ticks: { color: "#e0f7fa", font: { size: 15 } },
                        },
                      },
                    },
                  });
                } else {
                  document
                    .getElementById("graficaBarras")
                    .replaceWith(
                      "<div style='color:#ff7070;text-align:center;font-size:1.2rem;'>Error: Chart.js no est√° cargado</div>"
                    );
                }
              } catch (e) {
                document
                  .getElementById("graficaBarras")
                  .replaceWith(
                    "<div style='color:#ff7070;text-align:center;font-size:1.2rem;'>Error al mostrar la gr√°fica</div>"
                  );
              }
            }, 0);
          }
        }
      }
      // Cambia este valor para elegir la pantalla inicial (0 = primera, 1 = segunda, etc)
      let pantallaInicial = 0;

      // Funci√≥n para navegar entre pantallas
      function navegarPantalla(direccion) {
        if (totalPantallas <= 1) return;
        if (direccion === "siguiente") {
          currentPantalla = (currentPantalla + 1) % totalPantallas;
        } else if (direccion === "anterior") {
          currentPantalla =
            (currentPantalla - 1 + totalPantallas) % totalPantallas;
        }
        renderPantalla(currentPantalla);
      }

      // Escuchar mensajes del padre
      window.addEventListener("message", function (event) {
        if (event.data === "navegarSiguiente") {
          navegarPantalla("siguiente");
        } else if (event.data && event.data.action === "renderPantalla") {
          const index = event.data.index;
          if (index >= 0 && index < totalPantallas) {
            currentPantalla = index;
            renderPantalla(currentPantalla);
          }
        }
      });

      async function updateDataAndRender() {
        let accionesPrevias = acciones;
        let justificacionesPrevias = justificaciones;
        try {
          await Promise.all([fetchAcciones(), fetchJustificaciones()]);
        } catch (e) {
          // Si falla la carga, restaurar los datos previos
          acciones = accionesPrevias;
          justificaciones = justificacionesPrevias;
        }
        if (!acciones.length) return; // Si no hay datos, no borres nada
        totalPantallas = (acciones[0].pantallas || []).length || 1;
        // Si el valor es inv√°lido, muestra la primera
        currentPantalla =
          pantallaInicial >= 0 && pantallaInicial < totalPantallas
            ? pantallaInicial
            : 0;
        renderPantalla(currentPantalla);
      }

      // Refresca datos cada 60s
      //setInterval(updateDataAndRender, 60000);
      window.addEventListener("DOMContentLoaded", updateDataAndRender);
    </script>
  </body>
</html>